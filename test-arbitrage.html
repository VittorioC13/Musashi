<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Musashi Arbitrage Tester</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      max-width: 1200px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #1a1a1a;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .controls {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    label {
      display: inline-block;
      margin-right: 10px;
      font-weight: 600;
    }
    input, select, button {
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-right: 10px;
    }
    button {
      background: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
    }
    button:hover {
      background: #45a049;
    }
    #loading {
      color: #666;
      font-style: italic;
    }
    #results {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .opportunity {
      border-left: 4px solid #4CAF50;
      padding: 15px;
      margin-bottom: 15px;
      background: #f9f9f9;
      border-radius: 4px;
    }
    .opportunity h3 {
      margin: 0 0 10px 0;
      color: #1a1a1a;
    }
    .spread {
      font-size: 24px;
      font-weight: bold;
      color: #4CAF50;
      margin: 10px 0;
    }
    .market-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin: 15px 0;
    }
    .market-card {
      padding: 10px;
      background: white;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .market-card h4 {
      margin: 0 0 8px 0;
      font-size: 12px;
      text-transform: uppercase;
      color: #666;
    }
    .market-card .title {
      font-weight: 600;
      margin-bottom: 8px;
      color: #1a1a1a;
    }
    .market-card .price {
      font-size: 18px;
      font-weight: bold;
      color: #2196F3;
    }
    .meta {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      font-size: 14px;
      color: #666;
    }
    .action {
      background: #e3f2fd;
      padding: 10px;
      border-radius: 4px;
      margin-top: 10px;
      font-weight: 600;
      color: #1976D2;
    }
    .no-results {
      text-align: center;
      padding: 40px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>üîç Musashi Arbitrage Detector</h1>
  <p class="subtitle">Find price discrepancies across Polymarket and Kalshi</p>

  <div class="controls">
    <label>Min Spread:</label>
    <input type="number" id="minSpread" value="0.03" step="0.01" min="0" max="1">

    <label>Category:</label>
    <select id="category">
      <option value="">All Categories</option>
      <option value="crypto">Crypto</option>
      <option value="us_politics">US Politics</option>
      <option value="economics">Economics</option>
      <option value="technology">Technology</option>
      <option value="sports">Sports</option>
      <option value="geopolitics">Geopolitics</option>
      <option value="climate">Climate</option>
    </select>

    <button onclick="fetchArbitrage()">Find Arbitrage</button>
    <span id="loading" style="display:none;">Loading...</span>
  </div>

  <div id="results"></div>

  <script>
    async function fetchArbitrage() {
      const minSpread = parseFloat(document.getElementById('minSpread').value);
      const category = document.getElementById('category').value;
      const loading = document.getElementById('loading');
      const results = document.getElementById('results');

      loading.style.display = 'inline';
      results.innerHTML = '';

      try {
        // Send message to service worker
        const response = await chrome.runtime.sendMessage({
          type: 'GET_ARBITRAGE',
          minSpread: minSpread,
          category: category || undefined
        });

        loading.style.display = 'none';

        const opportunities = response.opportunities || [];

        if (opportunities.length === 0) {
          results.innerHTML = '<div class="no-results">No arbitrage opportunities found with current filters.</div>';
          return;
        }

        results.innerHTML = `
          <h2>Found ${opportunities.length} Arbitrage Opportunities</h2>
          ${opportunities.map((op, idx) => `
            <div class="opportunity">
              <h3>#${idx + 1} - ${op.matchReason}</h3>
              <div class="spread">${(op.spread * 100).toFixed(1)}% Spread</div>
              <div class="action">
                ${op.direction === 'buy_poly_sell_kalshi'
                  ? 'üìà Buy on Polymarket, Sell on Kalshi'
                  : 'üìà Buy on Kalshi, Sell on Polymarket'}
              </div>

              <div class="market-info">
                <div class="market-card">
                  <h4>Polymarket</h4>
                  <div class="title">${op.polymarket.title}</div>
                  <div class="price">YES: ${(op.polymarket.yesPrice * 100).toFixed(0)}%</div>
                  <div class="meta">
                    <span>üìä ${formatVolume(op.polymarket.volume24h)}</span>
                    <span>üè∑Ô∏è ${op.polymarket.category}</span>
                  </div>
                </div>

                <div class="market-card">
                  <h4>Kalshi</h4>
                  <div class="title">${op.kalshi.title}</div>
                  <div class="price">YES: ${(op.kalshi.yesPrice * 100).toFixed(0)}%</div>
                  <div class="meta">
                    <span>üìä ${formatVolume(op.kalshi.volume24h)}</span>
                    <span>üè∑Ô∏è ${op.kalshi.category}</span>
                  </div>
                </div>
              </div>

              <div class="meta">
                <span>üí∞ Profit Potential: ${(op.profitPotential * 100).toFixed(1)}%</span>
                <span>‚úÖ Confidence: ${(op.confidence * 100).toFixed(0)}%</span>
              </div>
            </div>
          `).join('')}
        `;

      } catch (error) {
        loading.style.display = 'none';
        results.innerHTML = `<div class="no-results">Error: ${error.message}<br><br>Make sure the Musashi extension is installed and running.</div>`;
        console.error('Arbitrage fetch error:', error);
      }
    }

    function formatVolume(volume) {
      if (volume >= 1000000) {
        return `$${(volume / 1000000).toFixed(1)}M`;
      } else if (volume >= 1000) {
        return `$${(volume / 1000).toFixed(0)}K`;
      }
      return `$${volume.toFixed(0)}`;
    }

    // Auto-fetch on page load
    window.addEventListener('load', () => {
      setTimeout(fetchArbitrage, 500);
    });
  </script>
</body>
</html>
